// Location Service Prisma Schema
generator client {
    provider      = "prisma-client-js"
    output        = "../../../node_modules/.prisma/location-client"
    binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Location {
    id        String       @id @default(cuid())
    name      String
    address   String
    latitude  Float
    longitude Float
    city      String
    state     String
    country   String       @default("US")
    zipCode   String       @map("zip_code")
    type      LocationType @default(GENERAL)
    isActive  Boolean      @default(true) @map("is_active")
    metadata  Json?
    createdAt DateTime     @default(now()) @map("created_at")
    updatedAt DateTime     @updatedAt @map("updated_at")

    // Relations
    pickupLocations  VehiclePickupLocation[]
    dropoffLocations VehicleDropoffLocation[]

    @@map("locations")
}

model VehiclePickupLocation {
    id         String   @id @default(cuid())
    vehicleId  String   @map("vehicle_id")
    locationId String   @map("location_id")
    isDefault  Boolean  @default(false) @map("is_default")
    createdAt  DateTime @default(now()) @map("created_at")

    // Relations
    location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

    @@unique([vehicleId, locationId])
    @@map("vehicle_pickup_locations")
}

model VehicleDropoffLocation {
    id         String   @id @default(cuid())
    vehicleId  String   @map("vehicle_id")
    locationId String   @map("location_id")
    isDefault  Boolean  @default(false) @map("is_default")
    createdAt  DateTime @default(now()) @map("created_at")

    // Relations
    location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

    @@unique([vehicleId, locationId])
    @@map("vehicle_dropoff_locations")
}

model LocationHistory {
    id         String   @id @default(cuid())
    vehicleId  String   @map("vehicle_id")
    latitude   Float
    longitude  Float
    address    String
    city       String
    state      String
    country    String   @default("US")
    zipCode    String   @map("zip_code")
    recordedAt DateTime @default(now()) @map("recorded_at")

    @@map("location_history")
}

enum LocationType {
    GENERAL
    AIRPORT
    TRAIN_STATION
    BUS_STATION
    SHOPPING_MALL
    HOSPITAL
    SCHOOL
    OFFICE
    RESIDENTIAL
    PARKING_LOT
    GAS_STATION
    OTHER
}
